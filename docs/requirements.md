# 医療的ケア児支援課題管理システム - 要件定義書

**最終更新**: 2025-12-24
**バージョン**: 1.0
**ステータス**: 確定

---

## 要件定義の作成原則
- **「あったらいいな」は絶対に作らない**
- **拡張可能性のための余分な要素は一切追加しない**
- **将来の「もしかして」のための準備は禁止**
- **今、ここで必要な最小限の要素のみ**

---

## 1. プロジェクト概要

### 1.1 成果目標
**医療的ケア児支援の課題を構造化・可視化し、自治体職員のExcel管理作業を50%以上削減、課題解決を加速させる課題管理システム**

### 1.2 成功指標

#### 定量的指標
1. **Excel作業時間削減**: 50%以上
2. **MVP完成**: 1月中旬（遅くとも3月末）
3. **課題登録時間**: 5分以内/件
4. **月間アクティブユーザー率**: 80%以上（神奈川県職員）
5. **導入自治体数**: 1年以内に3自治体以上

#### 定性的指標
1. **神奈川県でのデモ成功**: 好評価を得る
2. **直感的なUI**: 非エンジニアが説明なしで使える
3. **課題解決の加速**: 構造化された課題管理が実現
4. **シンプルなデザイン**: Backlogのようなゴチャゴチャ感なし、視認性重視
5. **実務運用適合**: チームメンバーが互いの課題を編集できる柔軟性

---

## 2. システム全体像

### 2.1 主要機能一覧
- **課題管理**: 課題の登録・編集・削除、属性管理
- **一覧表示**: テーブル形式での課題一覧、フィルタリング、ソート
- **認証機能**: メール + パスワード認証（MVP簡略版）

### 2.2 ユーザーロールと権限

#### MVP段階（単一ロール）
- **ログインユーザー**: 全員が同じ権限（管理者ロールなし）
  - 全課題の閲覧
  - 課題の作成
  - **全課題の編集・削除（誰が作成した課題でも編集可能）**

#### 将来拡張（Phase 2以降）
- 管理者ロールの追加
- 編集履歴の記録
- より詳細な権限設定

### 2.3 認証・認可要件

#### 認証方式
- メール + パスワード
- メール確認: 不要（MVP簡略化）

#### セキュリティレベル
- 基本的な認証機能（Clerk / Auth.js使用）
- HTTPS強制（本番環境）
- セッション管理

#### 権限マトリックス

| 機能/ページ        | ゲスト | ログインユーザー | 備考               |
|--------------------|--------|------------------|--------------------|
| ログインページ     | ○      | ×                | 未ログインのみ     |
| サインアップページ | ○      | ×                | 未ログインのみ     |
| 課題一覧ページ     | ×      | ○                | 要ログイン         |
| 課題詳細ページ     | ×      | ○                | 要ログイン         |
| 課題作成           | ×      | ○                | 要ログイン         |
| 課題編集           | ×      | ○（全員）        | **全員が編集可能** |
| 課題削除           | ×      | ○（全員）        | **全員が削除可能** |

**設計理由:**
- 神奈川県での実務運用を考慮（誰かが登録した課題を別の人が編集できる必要がある）
- MVP段階では全員が信頼できるメンバー前提
- 削除時の確認ダイアログでミス防止

---

## 3. ページ詳細仕様

### 3.1 P-001: 課題一覧ページ（Task List）

#### 目的
全課題を一覧表示し、ステータスと優先度を把握する

#### 主要機能
- 課題一覧テーブル表示
  - 列: 項番、項目（カテゴリ）、問題点、進捗ステータス、対応者、期限
- フィルタリング機能
  - 項目（カテゴリ）別
  - 進捗ステータス別
  - 対応者別
- ソート機能（項番、期限、ステータス等）
- 新規課題登録ボタン（→ P-002へ遷移）
- 課題クリックで詳細表示（→ P-002へ遷移）

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | 課題一覧を取得 | フィルタ条件（任意） | 課題一覧データ |
| フィルター | 条件に合致する課題を抽出 | カテゴリ、ステータス、対応者 | フィルター済み一覧 |
| ソート | 指定列でソート | 列名、昇順/降順 | ソート済み一覧 |

#### 処理フロー
1. ユーザーがページにアクセス
2. システムが全課題をデータベースから取得
3. テーブル形式で表示
4. フィルター/ソート操作に応じてリアルタイム更新
5. 課題クリックで詳細ページへ遷移

#### データ構造（概念）
```yaml
TaskList:
  識別子: 取得条件（フィルター、ソート）
  基本情報:
    - tasks: Task[]（課題配列）
  フィルター条件:
    - category: 項目（カテゴリ）（任意）
    - status: 進捗ステータス（任意）
    - assignee: 対応者（任意）
  ソート条件:
    - sortBy: ソート列名（任意）
    - sortOrder: 昇順/降順（任意）
```

---

### 3.2 P-002: 課題詳細ページ（Task Detail）

#### 目的
課題の登録・編集・削除を行い、詳細情報を管理する

#### 主要機能
- 課題情報の表示・編集
  - 項目（カテゴリ）選択
  - 問題点入力
  - 原因（複数登録可、追加・削除可能）
  - 対応案（複数登録可、追加・削除可能）
  - 進捗ステータス選択
  - 対応者（複数選択可）
  - 期限選択
  - 関連事業、事業内容、該当所属
- 保存ボタン（登録/更新）
- 削除ボタン（確認ダイアログ付き）
- 戻るボタン（→ P-001へ遷移）

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | 課題詳細を取得 | 課題ID | 課題詳細データ |
| 作成 | 新規課題を登録 | 全課題属性 | 登録成功/失敗 |
| 更新 | 既存課題を更新 | 課題ID、更新内容 | 更新成功/失敗 |
| 削除 | 課題を削除 | 課題ID | 削除成功/失敗 |

#### 処理フロー
1. ユーザーが新規登録 or 課題をクリック
2. 新規の場合: 空フォーム表示
3. 編集の場合: 既存データを取得して表示
4. ユーザーが情報を入力・編集
5. 保存ボタンクリック → データベースに保存
6. 削除ボタンクリック → 確認ダイアログ → 削除実行
7. 一覧ページへ戻る

#### データ構造（概念）
```yaml
Task:
  識別子: id (UUID)
  基本情報:
    - task_number: 項番（自動採番）
    - category: 項目（カテゴリ）（必須）
    - problem: 問題点（必須）
    - status: 進捗ステータス（未着手/進行中/完了）
    - deadline: 期限（任意）
    - related_business: 関連事業（任意）
    - business_content: 事業内容（任意）
    - organization: 該当所属（任意）
  メタ情報:
    - created_at: 作成日時
    - updated_at: 更新日時
    - created_by: 作成者（ユーザーID）
  関連:
    - causes: 原因（1対多）
    - actions: 対応案（1対多）
    - assignees: 対応者（1対多）
```

---

## 4. データ設計概要

### 4.1 主要エンティティ

```yaml
Task（課題）:
  概要: 医療的ケア児支援における課題情報
  主要属性:
    - 識別情報: id, task_number
    - 課題内容: category, problem, status
    - 詳細情報: deadline, related_business, business_content, organization
    - メタ情報: created_at, updated_at, created_by
  関連:
    - Cause（原因）: 1対多
    - Action（対応案）: 1対多
    - Assignee（対応者）: 1対多

Cause（原因）:
  概要: 課題の原因
  主要属性:
    - 識別情報: id
    - 内容: cause
    - メタ情報: created_at
  関連:
    - Task（課題）: 多対1

Action（対応案）:
  概要: 課題への対応案
  主要属性:
    - 識別情報: id
    - 内容: action
    - メタ情報: created_at
  関連:
    - Task（課題）: 多対1

Assignee（対応者）:
  概要: 課題の対応者
  主要属性:
    - 識別情報: id
    - 対応者情報: name, organization
    - メタ情報: created_at
  関連:
    - Task（課題）: 多対1

User（ユーザー）:
  概要: システム利用者
  主要属性:
    - 識別情報: id
    - 認証情報: email, hashed_password
    - メタ情報: created_at, updated_at
  関連:
    - Task（課題）: 1対多（作成者）
```

### 4.2 エンティティ関係図
```
User ──1:N── Task ─┬─1:N─ Cause
                   ├─1:N─ Action
                   └─1:N─ Assignee
```

### 4.3 バリデーションルール

```yaml
Task:
  category:
    - ルール: 必須、選択肢から選択
    - 理由: 課題の分類に必要
  problem:
    - ルール: 必須、最大500文字
    - 理由: 課題の核心情報
  status:
    - ルール: 必須、「未着手」「進行中」「完了」のいずれか
    - 理由: 進捗管理に必要
  deadline:
    - ルール: 任意、日付形式
    - 理由: 期限管理に使用

Cause:
  cause:
    - ルール: 必須、最大500文字
    - 理由: 原因の明確化

Action:
  action:
    - ルール: 必須、最大500文字
    - 理由: 対応案の明確化

Assignee:
  name:
    - ルール: 必須、最大100文字
    - 理由: 対応者の識別

User:
  email:
    - ルール: 必須、有効なメール形式、一意
    - 理由: ログイン認証とアカウント識別
  password:
    - ルール: 必須、8文字以上
    - 理由: セキュリティ確保
```

---

## 5. 制約事項

### 技術的制約
- **Neonデータベース制限**: 無料枠0.5GB（50件程度の課題管理には十分）
- **Vercel制限**: 無料枠（ホビープロジェクトに適切）
- **モバイル対応**: 後回し（PC優先）

---

## 5.1 セキュリティ要件

### 基本方針
本プロジェクトは **CVSS 3.1（Common Vulnerability Scoring System）** に準拠したセキュリティ要件を満たすこと。

CVSS 3.1の評価観点:
- **機密性（Confidentiality）**: 不正アクセス防止、データ暗号化
- **完全性（Integrity）**: データ改ざん防止、入力検証
- **可用性（Availability）**: DoS対策、冗長化

詳細な診断と改善は、Phase 11（本番運用診断）で @本番運用診断オーケストレーター が実施します。

---

### プロジェクト固有の必須要件

**認証機能（必須）**:
- ✅ ブルートフォース攻撃対策（アカウントロックアウト）
- ✅ パスワードポリシー（8文字以上）
- ✅ セッション管理（タイムアウト、CSRF対策）

**その他の一般要件**:
- ✅ HTTPSの強制（本番環境）
- ✅ セキュリティヘッダー設定（本番環境）
- ✅ 入力値のサニタイゼーション
- ✅ エラーメッセージでの情報漏洩防止

---

### 運用要件：可用性とヘルスチェック

**ヘルスチェックエンドポイント（全プロジェクト必須）**:
- エンドポイント: `/api/health`
- 目的: Vercel Serverless Functionsでの稼働確認
- 要件: データベース接続確認、5秒以内の応答

**グレースフルシャットダウン（全プロジェクト必須）**:
- SIGTERMシグナルハンドラーの実装
- 進行中のリクエスト完了まで待機
- タイムアウト: 8秒

---

## 6. 複合API処理（バックエンド内部処理）

**注意**: このセクションは、複雑な処理フローがある場合のみ記載してください。

### 複合処理-001: 課題の一括取得とフィルタリング
**トリガー**: 課題一覧ページアクセス
**フロントエンドAPI**: GET /api/tasks
**バックエンド内部処理**:
1. データベースから全課題を取得
2. 関連する原因・対応案・対応者を結合（JOIN）
3. フィルタ条件を適用（カテゴリ、ステータス、対応者）
4. ソート条件を適用
**結果**: フィルター・ソート済み課題一覧
**外部サービス依存**: Neon PostgreSQL

### 複合処理-002: 課題の作成・更新
**トリガー**: 課題詳細ページで保存ボタンクリック
**フロントエンドAPI**: POST /api/tasks（新規）/ PUT /api/tasks/:id（更新）
**バックエンド内部処理**:
1. バリデーション実行
2. トランザクション開始
3. 課題本体を保存
4. 原因・対応案・対応者を保存（複数）
5. トランザクションコミット
**結果**: 保存成功/失敗
**外部サービス依存**: Neon PostgreSQL

---

## 7. 技術スタック

### フロントエンド
```yaml
フレームワーク: React 18
言語: TypeScript 5
UIライブラリ: shadcn/ui + Tailwind CSS
  選定理由:
    - 最もシンプル＆クリーン
    - 完全カスタマイズ可能
    - 最高パフォーマンス
    - Backlog的ゴチャゴチャ感を完全回避
状態管理: Zustand
ルーティング: React Router v6
データフェッチ: TanStack Query (React Query)
ビルドツール: Vite 5
フォント: Noto Sans JP / Inter
認証: Clerk
  選定理由:
    - MVP開発速度優先（簡単実装）
    - メール確認不要設定が可能
    - 無料枠5,000MAU
    - React SDK充実
```

### バックエンド
```yaml
データベース: Neon PostgreSQL
  選定理由:
    - 永続無料枠（0.5GB、24/7稼働）
    - Vercel公式統合
    - サーバーレスアーキテクチャ
ORM: Drizzle ORM
  選定理由:
    - TypeScript-first
    - 型安全なクエリビルダー
    - PostgreSQL完全対応
API: REST API（Vercel Serverless Functions）
  構成:
    - GET /api/tasks: 一覧取得
    - GET /api/tasks/:id: 詳細取得
    - POST /api/tasks: 新規作成
    - PUT /api/tasks/:id: 更新
    - DELETE /api/tasks/:id: 削除
    - GET /api/health: ヘルスチェック
  実装方法:
    - api/tasks/index.ts（一覧取得）
    - api/tasks/[id].ts（詳細・更新・削除）
    - api/tasks/create.ts（新規作成）
    - Drizzle ORMで型安全にNeon PostgreSQLへアクセス
```

### インフラ
```yaml
ホスティング: Vercel
  - フロントエンド: 無料枠（無制限デプロイ）
  - API: Serverless Functions（無料枠）
データベース: Neon PostgreSQL（無料枠）
認証: Clerk（無料枠5,000MAU）
```

### デザインシステム
```yaml
色使い（最大3色）:
  - ベース: 白・グレー系（#FFFFFF, #F3F4F6, #9CA3AF）
  - アクセント: ブルー系（#3B82F6）
  - 警告: レッド系（#EF4444）
  - 完了: グリーン系（#10B981）※最小限使用
フォント:
  - 和文: Noto Sans JP
  - 英文: Inter
原則: シンプル、視認性重視、Backlog的ゴチャゴチャ感なし
```

---

## 8. 必要な外部サービス・アカウント

### 必須サービス
| サービス名 | 用途 | 取得先 | 備考 |
|-----------|------|--------|------|
| Neon | PostgreSQLデータベース | https://neon.tech | 無料枠: 0.5GB、24/7稼働 |
| Vercel | フロントエンドホスティング＋API | https://vercel.com | 無料枠: 無制限デプロイ |
| GitHub | バージョン管理 | https://github.com | 無料 |
| Clerk | 認証機能 | https://clerk.com | 無料枠: 5,000MAU |

### オプションサービス（Phase 2以降）
| サービス名 | 用途 | 取得先 | 備考 |
|-----------|------|--------|------|
| TBD | ガントチャートライブラリ | - | Phase 2で選定 |

---

## 9. 今後の拡張予定

**原則**: 拡張予定があっても、必要最小限の実装のみを行う

- 「あったらいいな」は実装しない
- 拡張可能性のための余分な要素は追加しない
- 将来の「もしかして」のための準備は禁止
- 今、ここで必要な最小限の要素のみを実装

拡張が必要になった時点で、Phase 11: 機能拡張オーケストレーターを使用して追加実装を行います。

### 拡張候補（実装はしない）

**Phase 2: 機能拡張**
- ガントチャート表示
- 課題の統合・分解機能（ドラッグ&ドロップ）
- Excelインポート/エクスポート
- 管理者ロール
- 編集履歴の記録

**Phase 3: 本格運用**
- コメント機能
- 通知機能（メール、プッシュ通知）
- モバイル対応（レスポンシブ強化）

---

## 付録: 解決する課題（背景情報）

### 現状の問題点
1. **Excel管理の限界**
   - セル結合による構造破壊
   - 手作業での統合・分解
   - バージョン管理の困難さ
   - 複数人同時編集の不可

2. **進捗の不可視化**
   - 課題の優先順位が不明確
   - 対応状況が把握しづらい
   - 期限管理ができない

3. **情報共有の非効率**
   - 会議資料の作成に時間がかかる
   - 最新情報の把握が困難
   - 担当者間の連携不足

---

**要件定義書 終了**
